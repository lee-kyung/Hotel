<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybats-3-mapper.dtd">
 
<mapper namespace="kr.co.hotel.roomresv.RoomResvMapper">
	<select id="room_resv" resultType="kr.co.hotel.room.RoomVO">
		select * from room order by rname desc;
	</select>
	
	<select id="room_resvnext" resultType="kr.co.hotel.room.RoomVO">
		select * from room where rcode=#{param1}
	</select>
	
	<insert id="room_resv_ok" parameterType="kr.co.hotel.roomresv.RoomResvVO">
		insert into roombk(checkin,checkout,userid,rcode,binwon,bextbed,bmeal,btotal,bstate,bid,bkdate,bkname,bkphone)
		values(#{checkin},#{checkout},#{userid},#{rcode},#{binwon},#{bextbed},#{bmeal},#{btotal},1,#{bid},now(),#{bkname},#{bkphone})
	</insert>
	
	<update id="suUpdate">
	<![CDATA[update room set rsu=rsu-1 where #{param2}>=checkin and checkout>#{param2} and rcode=#{param1}]]>
	</update> 
	
	<!-- <update id="suUpdate">
		update room set rsu=rsu-1 where rcode=#{param1}
	</update> -->
	
	<select id="getBid" resultType="Integer">
		select ifnull(max(right(bid,4)),0) from roombk where userid=#{param1}
	</select>

	<select id="getRoomAvail" resultType="kr.co.hotel.room.RoomVO">
	<![CDATA[ select rcode, checkin from roombk where #{param1}>=checkin and checkout>#{param1} ]]>
	</select>  
	<!-- and rcode=#{param2} -->
	
<!-- 	<select id="getRoomAvail" resultType="kr.co.hotel.room.RoomVO">
	<![CDATA[ select rcode, count(*) as cnt from roombk where #{param1}>=checkin and checkout>#{param1} ]]>
	</select>   -->
	
	
	<select id="getCnt" resultType="kr.co.hotel.room.RoomVO">
	<![CDATA[ select rcode,count(*) as cnt from roombk where #{param1}>=checkin and checkout>#{param1} group by rcode]]>	
	</select>
	
	<!-- and rcode=#{rcode} -->
	
	
	
	
	
	
	
	
	
	
	
	
</mapper>